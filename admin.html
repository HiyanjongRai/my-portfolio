<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard • Hiyan Jong Rai</title>
<style>
  :root{
    --bg:#003153;
    --bg-soft:rgba(1,39,67,0.9);
    --text:#eef6ff;
    --muted:#dbe6f4;
    --border:rgba(255,255,255,.08);
    --brand:#0ea5e9;
    --brand-700:#0284c7;
    --radius-md:10px;
    --radius-lg:14px;
    --pad-card:12px;
    --gap:16px;
  }
  body{
    margin:0;
    font-family:"Roboto Condensed", sans-serif;
    background:var(--bg);
    color:var(--text);
  }
  header{
    position:sticky;
    top:0;
    background:rgba(0,49,83,0.85);
    backdrop-filter:blur(8px);
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 20px;
  }
  header h1{
    margin:0;
    font-size:1.5rem;
    color:#fff;
  }
  nav ul{
    display:flex;
    list-style:none;
    margin:0;
    padding:0;
    gap:12px;
  }
  nav ul li a{
    color:#fff;
    text-decoration:none;
    cursor:pointer;
  }
  main{
    padding:20px;
    max-width:1200px;
    margin:0 auto;
  }
  section{display:none;}
  section.active{display:block;}
  .section-title{
    font-size:1.5rem;
    margin-bottom:12px;
    text-align:center;
    position:relative;
  }
  .section-title::after{
    content:"";
    width:60px;
    height:3px;
    background:var(--brand);
    position:absolute;
    bottom:-8px;
    left:50%;
    transform:translateX(-50%);
  }
  .btn{
    padding:8px 14px;
    border:none;
    border-radius:var(--radius-md);
    background:var(--brand);
    color:#fff;
    cursor:pointer;
    margin:4px;
  }
  .btn:hover{background:var(--brand-700);}
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(220px,1fr));
    gap:var(--gap);
    margin-top:12px;
  }
  .card{
    background:var(--bg-soft);
    padding:var(--pad-card);
    border-radius:var(--radius-lg);
  }
  .card img{
    width:100%;
    height:140px;
    object-fit:cover;
    border-radius:6px;
  }
  .card-title{font-weight:700; color:var(--brand-300); margin:8px 0 4px;}
  .card-text{font-size:.9rem; color:var(--muted);}
</style>
</head>
<body>

<header>
  <h1>Dashboard</h1>
  <nav>
    <ul>
      <li><a id="nav-projects">Projects</a></li>
      <li><a id="nav-highlights">Highlights</a></li>
      <li><a id="logout">Logout</a></li>
      <li><span id="username">Hi, Admin</span></li>
    </ul>
  </nav>
</header>

<main>
  <section id="projects-section" class="active">
    <h2 class="section-title">Projects</h2>
    <div>
      <button class="btn" id="add-project">+ Add Project</button>
      <button class="btn" id="refresh-projects">↻ Refresh</button>
    </div>
    <div id="projects-list" class="grid"></div>
    <p id="projects-empty" style="text-align:center;display:none;">No projects yet.</p>
  </section>

  <section id="highlights-section">
    <h2 class="section-title">Highlights</h2>
    <div>
      <button class="btn" id="add-highlight">+ Add Highlight</button>
      <button class="btn" id="refresh-highlights">↻ Refresh</button>
    </div>
    <div id="highlights-list" class="grid"></div>
    <p id="highlights-empty" style="text-align:center;display:none;">No highlights yet.</p>
  </section>
</main>

<script>
const API_PROJECTS = "http://localhost:8080/api/projects";
const API_HIGHLIGHTS = "http://localhost:8080/api/images";

// Redirect if no JWT
const token = localStorage.getItem("jwtToken");
if(!token){
    window.location.href = "login.html";
}

// Set username
const username = localStorage.getItem("username") || "Admin";
document.getElementById("username").textContent = `Hi, ${username}`;

// Navigation
document.getElementById("nav-projects").addEventListener("click",()=>{
    document.getElementById("projects-section").classList.add("active");
    document.getElementById("highlights-section").classList.remove("active");
});
document.getElementById("nav-highlights").addEventListener("click",()=>{
    document.getElementById("highlights-section").classList.add("active");
    document.getElementById("projects-section").classList.remove("active");
});

// Logout
document.getElementById("logout").addEventListener("click",()=>{
    localStorage.clear();
    window.location.href="login.html";
});

// Fetch Projects
async function loadProjects(){
    const list = document.getElementById("projects-list");
    const empty = document.getElementById("projects-empty");
    list.innerHTML = "Loading...";
    empty.style.display = "none";
    try{
        const res = await fetch(API_PROJECTS, {
            headers: { "Authorization": `Bearer ${token}` }
        });
        if(!res.ok) throw new Error("Fetch error");
        const projects = await res.json();
        if(projects.length===0){
            list.innerHTML="";
            empty.style.display="block";
            return;
        }
        list.innerHTML = projects.map(p=>`
            <div class="card">
                <img src="${API_PROJECTS}/image/${p.id}" alt="${p.title}">
                <div class="card-title">${p.title}</div>
                <div class="card-text">${p.description || ""}</div>
            </div>
        `).join("");
    }catch(e){
        list.innerHTML = "Error loading projects.";
        console.error(e);
    }
}

// Fetch Highlights
async function loadHighlights(){
    const list = document.getElementById("highlights-list");
    const empty = document.getElementById("highlights-empty");
    list.innerHTML = "Loading...";
    empty.style.display = "none";
    try{
        const res = await fetch(API_HIGHLIGHTS, {
            headers: { "Authorization": `Bearer ${token}` }
        });
        if(!res.ok) throw new Error("Fetch error");
        const images = await res.json();
        if(images.length===0){
            list.innerHTML="";
            empty.style.display="block";
            return;
        }
        list.innerHTML = images.map(i=>`
            <div class="card">
                <img src="${API_HIGHLIGHTS}/${i.id}" alt="${i.name}">
                <div class="card-title">${i.name || "Untitled"}</div>
            </div>
        `).join("");
    }catch(e){
        list.innerHTML = "Error loading highlights.";
        console.error(e);
    }
}

// Initial load
loadProjects();
loadHighlights();

// Add buttons placeholders
document.getElementById("add-project").addEventListener("click",()=>alert("Add Project Form here"));
document.getElementById("add-highlight").addEventListener("click",()=>alert("Add Highlight Form here"));
document.getElementById("refresh-projects").addEventListener("click",loadProjects);
document.getElementById("refresh-highlights").addEventListener("click",loadHighlights);
</script>
</body>
</html>
